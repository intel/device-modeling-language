/*
  Â© 2024 Intel Corporation
  SPDX-License-Identifier: MPL-2.0
*/
dml 1.4;

device test;

/// API-VERSION 6
/// DMLC-FLAG --breaking-change=remove-port-proxy-ifaces

import "simics/simulator/conf-object.dml";

import "remove_port_proxy_ifaces.dml";

extern const char *strstr(const char *, const char *);

method init() {
    test(false);
    // nice message
    local attr_value_t pair = SIM_make_attr_list(
        2, SIM_make_attr_object(dev.obj), SIM_make_attr_string("b"));
    #foreach attr in (["rv", "no"]) {
        SIM_set_attribute(dev.obj, attr, &pair);
        assert SIM_clear_exception() == SimExc_InterfaceNotFound;
        log info: "%s", SIM_last_error();
        assert strstr(SIM_last_error(), "Did you mean obj.bank.b?") != NULL;
    }
    SIM_attr_free(&pair);

    pair = SIM_make_attr_list(
        2, SIM_make_attr_object(dev.obj), SIM_make_attr_string("p"));
    #foreach attr in (["sig", "no"]) {
        SIM_set_attribute(dev.obj, attr, &pair);
        assert SIM_clear_exception() == SimExc_InterfaceNotFound;
        assert strstr(SIM_last_error(), "Did you mean obj.port.p?") != NULL;
    }
}

bank b;
connect sig { interface signal; }
connect rv { interface register_view; }
connect no { }

